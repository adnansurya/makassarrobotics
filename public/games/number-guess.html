<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tebak Angka - Game Center</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* Tambahkan style untuk difficulty selector */
        .difficulty-selector {
            margin: 20px 0;
        }

        .difficulty-btn {
            padding: 8px 15px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .easy {
            background-color: #2ecc71;
            color: white;
        }

        .medium {
            background-color: #f39c12;
            color: white;
        }

        .hard {
            background-color: #e74c3c;
            color: white;
        }

        .active {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body>
    <div class="game-container">
        <h1 class="game-title">Tebak Angka</h1>
        <div id="gameContent">
            <p>Tebak angka antara 1 sampai <span id="maxNumber">100</span></p>
            <p>Percobaan tersisa: <span id="remainingAttempts">10</span></p>

            <div class="message" id="message"></div>

            <input type="number" id="guessInput" class="guess-input" min="1" max="100">
            <button onclick="checkGuess()" class="guess-button">Tebak</button>

            <div class="attempts">Percobaan: <span id="attempts">0</span></div>
        </div>

        <div class="high-score">
            <h3>High Score - <span id="difficultyDisplay">Sedang</span></h3>
            <div id="highScores"></div>
        </div>

        <button onclick="window.location.href='difficulty-selector.html?game=number-guess'" style="margin-top: 20px;">
            Ganti Tingkat Kesulitan
        </button>
        <button onclick="window.location.href='../index.html'" style="margin-top: 10px;">
            Kembali ke Game Center
        </button>
    </div>
    <script>

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAcHklpkVYko5ZyuQXaeHhGxa8F3UzxDp0",
            authDomain: "mksrobotics.firebaseapp.com",
            databaseURL: "https://mksrobotics.firebaseio.com",
            projectId: "mksrobotics",
            storageBucket: "mksrobotics.appspot.com",
            messagingSenderId: "236823766418",
            appId: "1:236823766418:web:31de7229a960e361"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Game variables
        let targetNumber;
        let attempts = 0;
        let currentDifficulty = 'medium';
        let maxNumber = 100;
        let maxAttempts = 7;

        // Initialize game
        function initGame() {
            // Get difficulty from URL
            const urlParams = new URLSearchParams(window.location.search);
            const difficulty = urlParams.get('difficulty') || 'medium';

            setDifficulty(difficulty);
        }

        // Set difficulty
        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;

            // Set game parameters based on difficulty
            switch (difficulty) {
                case 'easy':
                    maxNumber = 50;
                    maxAttempts = 10;
                    document.getElementById('difficultyDisplay').textContent = 'Mudah';
                    break;
                case 'medium':
                    maxNumber = 100;
                    maxAttempts = 7;
                    document.getElementById('difficultyDisplay').textContent = 'Sedang';
                    break;
                case 'hard':
                    maxNumber = 200;
                    maxAttempts = 5;
                    document.getElementById('difficultyDisplay').textContent = 'Sulit';
                    break;
            }

            // Update UI
            document.getElementById('maxNumber').textContent = maxNumber;
            document.getElementById('remainingAttempts').textContent = maxAttempts;

            // Reset game
            resetGame();
        }


        // Reset game
        function resetGame() {
            targetNumber = Math.floor(Math.random() * maxNumber) + 1;
            attempts = 0;
            document.getElementById('attempts').textContent = attempts;
            document.getElementById('message').textContent = `Tebak angka antara 1 sampai ${maxNumber}`;
            document.getElementById('guessInput').value = '';
            document.getElementById('guessInput').max = maxNumber;
            document.getElementById('guessInput').disabled = false;
            document.querySelector('.guess-button').disabled = false;
        }


        function checkGuess() {
            const guessInput = document.getElementById('guessInput');
            const messageElement = document.getElementById('message');
            const attemptsElement = document.getElementById('attempts');

            const guess = parseInt(guessInput.value);

            if (isNaN(guess) || guess < 1 || guess > maxNumber) {
                messageElement.textContent = `Masukkan angka antara 1 dan ${maxNumber}!`;
                return;
            }

            attempts++;
            attemptsElement.textContent = attempts;

            if (guess === targetNumber) {
                messageElement.textContent = `Selamat! Anda menebak angka ${targetNumber} dengan ${attempts} percobaan.`;
                messageElement.style.color = 'green';

                // Save score with difficulty
                const name = prompt('Selamat! Masukkan nama Anda untuk high score:');
                if (name) {
                    database.ref(`scores/numberGuess/${currentDifficulty}`).push({
                        name: name,
                        attempts: attempts,
                        maxNumber: maxNumber,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                }

                // Disable input and button
                guessInput.disabled = true;
                document.querySelector('.guess-button').disabled = true;

                // Reload high scores
                loadHighScores();
            } else if (attempts >= maxAttempts) {
                messageElement.textContent = `Game Over! Angka yang benar adalah ${targetNumber}.`;
                messageElement.style.color = 'red';
                guessInput.disabled = true;
                document.querySelector('.guess-button').disabled = true;
            } else if (guess < targetNumber) {
                messageElement.textContent = 'Terlalu rendah! Coba lagi.';
                messageElement.style.color = 'blue';
            } else {
                messageElement.textContent = 'Terlalu tinggi! Coba lagi.';
                messageElement.style.color = 'red';
            }

            guessInput.value = '';
            guessInput.focus();
        }

        // Initialize game
        document.getElementById('guessInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkGuess();
            }
        });

        // Load high scores with difficulty filter
        function loadHighScores() {
            database.ref(`scores/numberGuess/${currentDifficulty}`).orderByChild('attempts').limitToLast(5).on('value', (snapshot) => {
                const scores = snapshot.val();
                const highScoresElement = document.getElementById('highScores');
                highScoresElement.innerHTML = '';

                if (scores) {
                    const sortedScores = Object.entries(scores).sort((a, b) => a[1].attempts - b[1].attempts);

                    sortedScores.forEach(([key, score]) => {
                        const scoreElement = document.createElement('div');
                        scoreElement.textContent = `${score.name}: ${score.attempts} percobaan (1-${score.maxNumber})`;
                        highScoresElement.appendChild(scoreElement);
                    });
                } else {
                    highScoresElement.textContent = 'Belum ada high score';
                }
            });
        }

        // Start with easy difficulty
        // Initialize game when page loads
        window.onload = initGame;
    </script>
</body>

</html>